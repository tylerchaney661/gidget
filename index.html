function renderWakeCalendar(){
  const rows=loadWake();
  const box=document.querySelector('#calendar'); if(!box) return; box.innerHTML='';
  const title=document.querySelector('#calTitle'); if(title) title.textContent=calRef.toLocaleString(undefined,{month:'long',year:'numeric'});

  const y=calRef.getFullYear(), m=calRef.getMonth();
  const first=new Date(y,m,1);
  const start=new Date(first);
  const lead=(first.getDay()+6)%7; // Monday-first grid
  start.setDate(1-lead);

  for(let i=0;i<42;i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    const iso=ymd(d);
    const rec=rows.find(function(r){ return r.date===iso; });

    const cell=document.createElement('div');
    cell.className='cell';
    cell.style.opacity = (d.getMonth()===m)?1:.45;
    cell.innerHTML = '<div class="d">'+d.getDate()+'</div><div class="tiny mt">'+(rec&&rec.wake?rec.wake:'—')+'</div>';

    cell.onclick=function(){
      var html = '';
      if(rec){
        html =
          '<div><b>Date</b>: '+iso+'</div>'+
          '<div><b>Wake</b>: '+(rec.wake||'—')+'</div>'+
          '<div><b>Weight</b>: '+(rec.weight||'—')+' g</div>'+
          '<div><b>Mood</b>: '+(rec.mood||'—')+'</div>'+
          '<div class="mt"><b>Notes</b>: '+(rec.notes? String(rec.notes).replace(/</g,'&lt;'):'—')+'</div>'+
          '<div class="row mt end"><button id="editDayBtn" class="btn solid">Edit this day</button></div>';
      } else {
        html =
          '<div>No wake entry for '+iso+'.</div>'+
          '<div class="row mt end"><button id="editDayBtn" class="btn solid">Add entry</button></div>';
      }

      openModal('Wake • '+iso, html);

      var edit=document.getElementById('editDayBtn');
      if(edit){
        edit.onclick=function(){
          activateTab('log');
          document.getElementById('date').value=iso;
          document.getElementById('wake').value=(rec&&rec.wake)||'';
          document.getElementById('weight').value=(rec&&rec.weight)||'';
          document.getElementById('mood').value=(rec&&rec.mood)||'';
          document.getElementById('notes').value=(rec&&rec.notes)||'';
          document.getElementById('modal').hidden=true;
        };
      }
    };

    box.appendChild(cell);
  }
}

function renderStepsCalendar(){
  const rows=loadSteps();
  const box=document.querySelector('#stepsCalendar'); if(!box) return; box.innerHTML='';
  const title=document.querySelector('#stepsCalTitle'); if(title) title.textContent=stepsCalRef.toLocaleString(undefined,{month:'long',year:'numeric'});

  const y=stepsCalRef.getFullYear(), m=stepsCalRef.getMonth();
  const first=new Date(y,m,1);
  const start=new Date(first);
  const lead=(first.getDay()+6)%7;
  start.setDate(1-lead);

  for(let i=0;i<42;i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    const iso=ymd(d);
    const rec=rows.find(function(r){ return r.date===iso; });

    const cell=document.createElement('div');
    cell.className='cell';
    cell.style.opacity=(d.getMonth()===m)?1:.45;
    cell.innerHTML='<div class="d">'+d.getDate()+'</div><div class="tiny mt">'+(rec&&rec.steps?rec.steps:'—')+'</div>';

    cell.onclick=function(){
      var html='';
      if(rec){
        html =
          '<div><b>Date</b>: '+iso+'</div>'+
          '<div><b>Steps</b>: '+(rec.steps||'—')+'</div>'+
          '<div class="mt"><b>Notes</b>: '+(rec.notes? String(rec.notes).replace(/</g,'&lt;'):'—')+'</div>'+
          '<div class="row mt end"><button id="editStepsDayBtn" class="btn solid">Edit this day</button></div>';
      } else {
        html =
          '<div>No steps entry for '+iso+'.</div>'+
          '<div class="row mt end"><button id="editStepsDayBtn" class="btn solid">Add entry</button></div>';
      }

      openModal('Steps • '+iso, html);

      var edit=document.getElementById('editStepsDayBtn');
      if(edit){
        edit.onclick=function(){
          activateTab('steps-log');
          document.getElementById('stepsDate').value=iso;
          document.getElementById('stepsCount').value=(rec&&rec.steps)||'';
          document.getElementById('stepsNotes').value=(rec&&rec.notes)||'';
          document.getElementById('modal').hidden=true;
        };
      }
    };

    box.appendChild(cell);
  }
}